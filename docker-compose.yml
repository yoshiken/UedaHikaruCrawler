version: '3'
services:
    web:
        build: .
        volumes:
          - .:/app
        environment:
          PGHOST: postgres
          PGPORT: ${POSTGRES_PORT}
          PGUSER: ${POSTGRES_USER}
          PGPASSWORD: ${POSTGRES_PASSWORD}
        ports:
          - "80:8000"
        depends_on:
          - postgres
    postgres:
        build: docker/postgres
        ports:
          - "5432:${POSTGRES_PORT}"
        environment:
          POSTGRES_USER: ${POSTGRES_USER}
          POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
          POSTGRES_INITDB_ARGS: "--encoding=UTF-8 --locale=ja_JP.UTF-8"
          PGDATA: /var/lib/postgresql/data/pgdata
        volumes:
           - ./docker/postgres/data/:/var/lib/postgresql/data/
        user: root
        tty: true
        restart: always

    cron:
        build: docker/cron
        environment:
          PGHOST: postgres
          PGPORT: ${POSTGRES_PORT}
          PGUSER: ${POSTGRES_USER}
          PGPASSWORD: ${POSTGRES_PASSWORD}
        depends_on:
          - postgres
        volumes:
           - ./src/cron/:/src/
           - ./log/:/log/
